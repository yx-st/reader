╔══════════════════════════════════════════════════════════════════════╗
║     QuickJS + Legado 书源规则解析 完整示例                           ║
║     Reader 阅读器 JavaScript 引擎集成演示                            ║
╚══════════════════════════════════════════════════════════════════════╝

初始化 QuickJS 引擎...
✓ JS 引擎初始化成功

╔══════════════════════════════════════════════════════════════╗
║ 测试 1: 搜索 URL 模板处理                                    ║
╚══════════════════════════════════════════════════════════════╝

  书源 searchUrl 模板:
  https://www.example.com/search?q={{java.encodeURI(key)}}&page={{page}}&sign={{java.md5Encode(key + '123456')}}

  ┌─ 处理 {{java.encodeURI(key)}} ─┐
  结果: %E6%96%97%E7%A0%B4%E8%8B%8D%E7%A9%B9

  ┌─ 处理 {{java.md5Encode(key + '123456')}} ─┐
  结果: 2b3a6e24390e385cac5f2d0580f78125

  ┌─ 最终生成的搜索 URL ─┐
  https://www.example.com/search?q=%E6%96%97%E7%A0%B4%E8%8B%8D%E7%A9%B9&page=1&sign=2b3a6e24390e385cac5f2d0580f78125

╔══════════════════════════════════════════════════════════════╗
║ 测试 2: 搜索结果解析（含 JS 后处理）                         ║
╚══════════════════════════════════════════════════════════════╝

  模拟的搜索结果 JSON:
  [{"name":"  斗破苍穹  ","author":"天蚕土豆","url":"/book/123","cover":"//img.example.com/cover.jpg",...}]

  ┌─ 规则: $.name@js:result.trim() ─┐
  解析出的书名:
    1. 斗破苍穹
    2. 斗破苍穹前传

  ┌─ 规则: $.cover@js:处理相对协议 URL ─┐
  解析出的封面 URL:
    1. https://img.example.com/cover.jpg
    2. https://img.example.com/cover2.jpg

  ┌─ 规则: $.updateTime@js:java.timeFormat(result) ─┐
  解析出的更新时间:
    1. 2024-01-19 03:00:00
    2. 2024-01-18 03:00:00

╔══════════════════════════════════════════════════════════════╗
║ 测试 3: 章节列表解析（含翻页处理）                           ║
╚══════════════════════════════════════════════════════════════╝

  模拟的章节数据:
  [{"title":"第一章 陨落的天才","url":"/chapter/1"},...]

  ┌─ 规则: 格式化章节标题并拼接完整 URL ─┐
  解析出的章节:
    1. 第一章 陨落的天才 | https://www.example.com/chapter/1
    2. 第二章 斗之气 | https://www.example.com/chapter/2
    3. 第三章 客人 | https://www.example.com/chapter/3

  ┌─ 规则: 检测是否有下一页 ─┐
  下一页 URL: https://www.example.com/chapters?page=2

╔══════════════════════════════════════════════════════════════╗
║ 测试 4: 正文内容解析（含反爬虫 JS 解密）                     ║
╚══════════════════════════════════════════════════════════════╝

  模拟的加密正文 (Base64):
  6L+Z5piv5Yqg5a+G55qE5q2j5paH5YaF5a65Li4u

  ┌─ 规则: @js:java.base64Decode(result) ─┐
  解密后的内容: 这是加密的正文内容...

  ┌─ 规则: 复杂解密（需要获取密钥） ─┐
    [HTTP GET] https://api.example.com/getKey
    [JS LOG] 获取密钥响应: {"code":0,"data":{...}}
    [JS LOG] 解析密钥成功
    [JS LOG] 解密完成
  最终内容: 这是加密的正文内容...

╔══════════════════════════════════════════════════════════════╗
║ 测试 5: 变量存取和跨规则数据传递                             ║
╚══════════════════════════════════════════════════════════════╝

  ┌─ 场景: 保存和使用 Cookie/Token ─┐
    [HTTP POST] https://api.example.com/login
    [POST BODY] {"user":"test","pass":"123"}
    [JS LOG] Token 已保存
  登录结果: 登录成功

  ┌─ 使用保存的 Token 请求书架数据 ─┐
    [JS LOG] 使用 Token: mock_token_12345
    [JS LOG] 用户 ID: 10086
  构造的请求 URL: https://api.example.com/bookshelf?userId=10086&token=mock_token_12345

╔══════════════════════════════════════════════════════════════╗
║ 测试 6: 完整的书源规则链模拟                                 ║
╚══════════════════════════════════════════════════════════════╝

  模拟完整的书籍搜索和阅读流程:

  ┌─ Step 1: 构造搜索请求 ─┐
  搜索 URL: https://www.example.com/search?q=%E6%96%97%E7%A0%B4%E8%8B%8D%E7%A9%B9

  ┌─ Step 2: 解析搜索结果 ─┐
  书名: 斗破苍穹, 作者: 天蚕土豆

  ┌─ Step 3: 获取章节列表 ─┐
  章节列表:
    1. 第一章
    2. 第二章

  ┌─ Step 4: 获取正文内容 ─┐
  正文内容: 第一章：不幸的天才

  ✓ 完整流程测试完成!

╔══════════════════════════════════════════════════════════════════════╗
║                      所有测试完成!                                   ║
╚══════════════════════════════════════════════════════════════════════╝
